# 使用方法
1. 硬件：
   - GNSS的 *UART_C* 线 与 银色的串口转USB线相连，接在工控机上；
   - GNSS的电源线（标注 电流2A），与车底盘出来的线相接。此时GNSS电源灯应该常亮。
   - 惯导主体中，GNSS1 天线接在后面，GNSS2 天线接在前面。(重新安装后需要断电重启)
2. 软件：
   - 更改串口权限，使得程序可读取串口（如果有多个串口转USB设备时，可能是ttyUSB1...）
   ```bash
   sudo chmod 777 /dev/ttyUSB0
   ```
   - 启动gnss节点
  ```bash
  rosrun gnss_gpchc_driver gnssrtk_node
  ```
  此时应该能从话题中得到数据
3. 正常运行时注意事项：
   - 只有当组合导航系统第三第四两个灯常亮时才是正常的：第四个灯代表惯导就绪(如果不就绪，需要一直遥控车辆运动)。第三个灯代表GNSS信号(不常亮时不是稳定解，需要更改实验地点，通常在水池、李兆基西南角信号较好；或者参考4.2中的注册码)
   - 串口稳定状态应该是42(稳定，组合导航。如是其他状态则完全不可用。如52是浮动解)。此时应该是定位定向稳定解。连接GNSS对应的WIFI，在惯导->INS状态中能够查看。
   - 固件升级。固件发行日期应该在2021年后。更新后可以得到较稳定的航向角，否则。
   - 差分上不去。差分账号一个机器只能用一个，如同时登上另一个，原来的会掉线。
4. 改用司南mini600
   - 注意修改椭球参数使得相同。椭球参数及其具体意义：
     - 通过set/log pjkpara来进行投影参数设置/查询。包括椭球长半轴、扁率、中心纬度、中央子午线、纵轴加常数、横轴加常数六个参数。中心纬度、中央子午线定义了坐标原点的位置。
     - SET PJKPARA 6378137 298.257223563 0 117 0 500000
  
5. 其他注意事项：
   - 以下仅在不吐出数据时需要查看，按照前三点已经能正常运行。
   - 导航设备目前未付全款，连上wifi（名称GNSS-XXXX 密码 12345678）后，登录192.168.200.1，账号admin密码password。如果弹出对话框需要注册码则需要重新注册。
   - 初始化配置。测量GNSS天线，IMU相对车辆底盘的位置，并填写。参考华测文档P41-P45。使用*低速巡航模式*，*通用车载模式*未曾初始化成功过。
   - 其他细节请自行翻阅华测文档
   - ros nmea msgs包缺失
      - sudo apt-get install ros-melodic-nmea-msgs

## ROS 接口说明

1. 编译成节点 gnssrtk_node
2. 读取串口设备，输出话题
   - /gps（格式 nav_msgs::Odometry）：x,y 坐标，车身姿态角度(角度制) yaw(放置于 twist.angular.z)。x,y 方向速度分别表示东向速度和北向速度。
   - /gpchc（格式<std_msgs::String>）：读取到的原始字符。

3. 坐标系解析：东北天坐标系。正东方向为x, 正北方向为y, 角度(-180，180)x+为0，方向逆时针。

# map文件说明
- 该map是follow_roadmap模块继承而得。由相应的GUI(MIX软件)操作得到，但实际仅使用x,y坐标信息。
- 各列意义说明： 路段号， x, y, 车身朝向角， 0, 曲率，建议速度


[17:12:16:149]
center:
x= 4436737.736, 
y=186440.165 
$GPYBM,SN02910185,091215.90,+40.006706380,+116.328156157,39.365,241.420,9.159,0.004,-0.008,0.018,0.009,4436737.736,186440.165,-698.787,-669.752,4,5,18,0,0660,1.351,12,*75␍␊

park00
x=4436756.171
y=186452.621,

[17:15:12:747] $GPYBM,SN02910185,091512.50,+40.006876693,+116.328292842,40.966,184.888,0.732,0.046,-0.052,-0.005,0.070,4436756.171,186452.621,-679.877,-658.080,5,4,11,2,0660,1.006,12,*5E␍␊

